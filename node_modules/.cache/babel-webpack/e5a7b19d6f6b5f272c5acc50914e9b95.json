{"ast":null,"code":"import { GLOBAL_PARAM_KEY } from 'src/app/app-constants';\nimport { MASTER_DATA_DOMAIN } from 'src/app/constants/db.constants';\nimport { WidgetComponentBase } from 'src/app/utility/widget/widget-utility/widget-component-base';\nimport { ElginMapConfigModel, ElginMapDataModel } from '../elginmap/elginmap-model';\nimport { DesignationsModel } from './permit-map-designation-tab.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/server-api-interface-service.service\";\nimport * as i2 from \"src/app/services/validation.service\";\nimport * as i3 from \"src/app/services/app-repo-helper.service\";\nimport * as i4 from \"src/app/services/elgin-start-up.service\";\nimport * as i5 from \"@angular/flex-layout/flex\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/material/card\";\nimport * as i8 from \"@angular/material/checkbox\";\n\nfunction PermitMapDesignationTabComponent_div_33_li_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"li\", 17);\n    i0.ɵɵelementStart(1, \"mat-card\", 18);\n    i0.ɵɵelementStart(2, \"mat-checkbox\", 19);\n    i0.ɵɵlistener(\"change\", function PermitMapDesignationTabComponent_div_33_li_8_Template_mat_checkbox_change_2_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const i_r3 = restoredCtx.index;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return ctx_r4.onDesignationCheckBoxChange(i_r3, $event.checked);\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\");\n    i0.ɵɵelementStart(4, \"div\", 20);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 21);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 22);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const d_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", d_r2.isChecked);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(d_r2.code);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", d_r2.special_desig_description, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", d_r2.periodicityCode, \" \");\n  }\n}\n\nfunction PermitMapDesignationTabComponent_div_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"div\", 11);\n    i0.ɵɵelementStart(2, \"div\", 12);\n    i0.ɵɵelementStart(3, \"div\", 9);\n    i0.ɵɵelementStart(4, \"div\", 13);\n    i0.ɵɵtext(5, \"Designations\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"div\", 14);\n    i0.ɵɵelementStart(7, \"ul\", 15);\n    i0.ɵɵtemplate(8, PermitMapDesignationTabComponent_div_33_li_8_Template, 10, 4, \"li\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(8);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.dataModel.data.special_designations);\n  }\n}\n\nconst _c0 = [[[\"\", 8, \"elgin-map-view\"]]];\nconst _c1 = [\".elgin-map-view\"];\nexport let PermitMapDesignationTabComponent = /*#__PURE__*/(() => {\n  class PermitMapDesignationTabComponent extends WidgetComponentBase {\n    constructor(_serverApi, _validationService, _appRepoHelperService, _elginService) {\n      super(_serverApi, _validationService);\n      this._serverApi = _serverApi;\n      this._validationService = _validationService;\n      this._appRepoHelperService = _appRepoHelperService;\n      this._elginService = _elginService;\n      this.arrSpecialDesignationType = [];\n      this.arrSpecialDesignationPeriodicity = [];\n      this.designationList = [];\n      this.permitFormData = [];\n      this.designationListHide = false;\n      this.viewElginMapDataModel = ElginMapDataModel.getInstance();\n      this.viewElginMapConfigModel = ElginMapConfigModel.getInstance();\n    }\n\n    ngOnInit() {\n      super.wgOnInit();\n    }\n\n    setFieldData() {\n      this.arrSpecialDesignationType = this._appRepoHelperService.getMDataByDomain(MASTER_DATA_DOMAIN.SPECIAL_DESIGNATION_TYPE.toString());\n      this.arrSpecialDesignationPeriodicity = this._appRepoHelperService.getMDataByDomain(MASTER_DATA_DOMAIN.SPECIAL_DESIGNATION_PERIODICITY.toString());\n    }\n\n    setMode(responseDataModel) {}\n\n    setValue(responseDataModel) {}\n\n    getControlData() {\n      return new Promise((resolve, reject) => {\n        let permitform = Object.assign(Object.assign({}, this.dataModel.globalParameters.get(GLOBAL_PARAM_KEY.VIEW_PERMIT_FORM)), this.dataModel.globalParameters.get(GLOBAL_PARAM_KEY.ELGIN_MAP));\n        permitform = permitform ? permitform : new Object();\n\n        if (permitform) {\n          resolve(permitform);\n        } else {\n          reject(permitform);\n        }\n      });\n    }\n\n    convertData(response) {\n      this.permitFormData.push(response);\n\n      if (response) {\n        console.log(\"response map tab\", response);\n        this.dataModel.data.special_designations = response.nsgDetails.special_designations;\n        this.dataModel.data.special_designations.forEach(element => {\n          let designation = new DesignationsModel();\n\n          if (element.special_desig_description != null) {\n            designation.description = element.special_desig_description;\n            this.arrSpecialDesignationType.forEach(designationType => {\n              if (designationType.key == element.street_special_desig_code.toString()) {\n                designation.code = designationType.displayText;\n              }\n            });\n\n            if (element.special_desig_start_time != null && element.special_desig_end_time != null && (element.special_desig_start_time != 0 || element.special_desig_end_time != 0)) {\n              designation.startTime = this.converNumberToHHMM(element.special_desig_start_time.toString());\n              designation.endTime = this.converNumberToHHMM(element.special_desig_end_time.toString());\n            }\n\n            this.arrSpecialDesignationPeriodicity.forEach(periodicity => {\n              if (periodicity.key == element.special_desig_periodicity_code.toString()) {\n                designation.periodicityCode = periodicity.displayText;\n              }\n            });\n\n            if (designation.startTime != null && designation.endTime != null) {\n              designation.startTime = designation.startTime;\n              designation.endTime = designation.endTime;\n              designation.periodicityCode = `${designation.periodicityCode} (${designation.startTime} - ${designation.endTime})`;\n            }\n\n            element.isChecked = false;\n            let specialDesignation = Object.assign(Object.assign({}, designation), element);\n            this.designationList.push(specialDesignation);\n\n            if (this.designationList.length < 1) {\n              this.designationListHide = true;\n            }\n          }\n        });\n        console.log(\"selected list\", this.designationList);\n        this.getNSGDetailsByUsrn(response.nsgDetails.usrn);\n      }\n    }\n\n    getNSGDetailsByUsrn(usrns) {\n      this._elginService.getNSGDetailsByUsrn(usrns).then(response => {\n        console.log('---------NSG Details By USRNS-----------');\n        console.log(response); // this.dataModel.data.traffic_sensitive = response.traffic_sensitive;\n\n        this.dataModel.data.special_designations = [];\n        response.special_designation_details.forEach(element => {\n          let designation = new DesignationsModel();\n          let existingDesignation = this.dataModel.data.special_designations.find(a => a.special_desig_description === element.special_desig_description); // if (!existingDesignation) {\n\n          if (element.special_desig_description != null) {\n            designation.description = element.special_desig_description;\n            this.arrSpecialDesignationType.forEach(designationType => {\n              if (designationType.key == element.street_special_desig_code) {\n                designation.code = designationType.displayText;\n              }\n            });\n\n            if (element.special_desig_start_time != null && element.special_desig_end_time != null && (element.special_desig_start_time != 0 || element.special_desig_end_time != 0)) {\n              // designation.startTime = this.converNumberToHHMM(element.special_desig_start_time.toString());\n              // designation.endTime = this.converNumberToHHMM(element.special_desig_end_time.toString());\n              designation.startTime = element.special_desig_start_time;\n              designation.endTime = element.special_desig_end_time;\n            }\n\n            this.arrSpecialDesignationPeriodicity.forEach(periodicity => {\n              // if (periodicity.key == element.special_desig_periodicity_code_string) {\n              //   designation.periodicityCode = periodicity.displayText;\n              // }\n              if (periodicity.key == element.special_desig_periodicity_code) {\n                designation.periodicityCode = periodicity.displayText;\n              }\n            });\n\n            if (designation.startTime != null && designation.endTime != null) {\n              designation.startTime = designation.startTime;\n              designation.endTime = designation.endTime;\n              designation.periodicityCode = `${designation.periodicityCode} (${designation.startTime} - ${designation.endTime})`;\n            }\n\n            element.isChecked = false;\n            let specialDesignation = Object.assign(Object.assign({}, designation), element);\n            this.dataModel.data.special_designations.push(specialDesignation);\n          } // }\n\n        });\n        this.markDesignationsChecked();\n        console.log(\"special_desination from usrn\", this.dataModel.data.special_designations); // this.dataModel.createPermitJSON.nsgDetails = response;\n        // this.dataModel.data.road_category = response.road_category;\n        // this.dataModel.data.authority_swa_code = response.authority_swa_code;\n        // this.dataModel.data.roadType = this._appRepoHelperService.getMDataDisplayTextByValue(response.road_category.toString());\n      });\n    }\n\n    onDesignationCheckBoxChange(i, isChecked) {\n      this.dataModel.data.special_designations[i].isChecked = isChecked; // let mapobject: any = this.dataModel.globalParameters.get(GLOBAL_PARAM_KEY.ELGIN_MAP);\n      // mapobject.nsgDetails.special_designations=temparray;\n      //   this.globalParameters.set(GLOBAL_PARAM_KEY.ELGIN_MAP, mapobject);\n      //   let mapobject2: any = this.dataModel.globalParameters.get(GLOBAL_PARAM_KEY.ELGIN_MAP);\n      //   console.log(\"mapobject 2\",mapobject2)\n    }\n\n    getValue() {\n      const data = this.dataModel.data;\n      return data;\n    }\n\n    markDesignationsChecked() {\n      try {\n        console.log(\"datamodel data\", this.dataModel.data);\n        let specialDesignations = this.dataModel.globalParameters.get(GLOBAL_PARAM_KEY.ELGIN_MAP).nsgDetails.special_designations;\n        let temparray; // let specialDesignations: any = this.designationList;\n        //  alert(specialDesignations.length)\n\n        if (specialDesignations && specialDesignations.length > 0) {\n          this.dataModel.data.special_designations.forEach(pSpecialDesig => {\n            specialDesignations.forEach(cSpecialDesig => {\n              console.log(\"cSpecialDesig\", cSpecialDesig);\n              console.log(\"pSpecialDesig\", pSpecialDesig); // let pSpecialDesigForCompare = pSpecialDesig.special_desig_description+pSpecialDesig.special_desig_start_time+pSpecialDesig.special_desig_end_time;\n              // let pSpecialDesigForCompare = pSpecialDesig.description+(pSpecialDesig.special_desig_start_time).toString()+(pSpecialDesig.special_desig_end_time).toString();\n\n              let pSpecialDesigForCompare = pSpecialDesig.description + pSpecialDesig.special_desig_start_time + pSpecialDesig.special_desig_end_time; // let cSpecialDesigForCompare = cSpecialDesig.special_desig_description+cSpecialDesig.special_desig_start_time+cSpecialDesig.special_desig_end_time;\n              // let cSpecialDesigForCompare = cSpecialDesig.special_desig_description+(cSpecialDesig.special_desig_start_time).toString()+(cSpecialDesig.special_desig_end_time).toString();\n\n              let cSpecialDesigForCompare = cSpecialDesig.special_desig_description + this.converNumberToHHMM(cSpecialDesig.special_desig_start_time + '') + this.converNumberToHHMM(cSpecialDesig.special_desig_end_time + ''); //  alert(pSpecialDesigForCompare +\" VS \"+cSpecialDesigForCompare)\n\n              if (pSpecialDesigForCompare === cSpecialDesigForCompare) {\n                // pSpecialDesig.isChecked = cSpecialDesig.isChecked;\n                pSpecialDesig.isChecked = true;\n              } // temparray.push(pSpecialDesig)\n\n            });\n          }); // this.setGlobalParams(this.permitMapDesignationModel);\n          // this.globalParameters.set((GLOBAL_PARAM_KEY.ELGIN_MAP)., this.dataModel.data.special_designations);\n          //   this.PermitMapDesignationModel.globalParameters.set((GLOBAL_PARAM_KEY.ELGIN_MAP), this.globalParameters.get(GLOBAL_PARAM_KEY.ELGIN_MAP));\n          //   this.setGlobalParams(this.permitMapDesignationModel);\n          // let specialDesignations: any = this.dataModel.globalParameters.get(GLOBAL_PARAM_KEY.ELGIN_MAP).nsgDetails.special_designations;\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    }\n\n    converNumberToHHMM(time) {\n      let convertedTime = '';\n\n      switch (time.toString().length) {\n        case 1:\n          convertedTime = \"00:0\" + time;\n          break;\n\n        case 2:\n          convertedTime = \"00:\" + time;\n          break;\n\n        case 3:\n          convertedTime = \"0\" + time.substring(0, 1) + \":\" + time.substring(1, 3);\n          break;\n\n        case 4:\n          convertedTime = time.substring(0, 2) + \":\" + time.substring(2, 4);\n          break;\n\n        default:\n          break;\n      }\n\n      return convertedTime;\n    }\n\n  }\n\n  PermitMapDesignationTabComponent.ɵfac = function PermitMapDesignationTabComponent_Factory(t) {\n    return new (t || PermitMapDesignationTabComponent)(i0.ɵɵdirectiveInject(i1.ServerApiInterfaceServiceService), i0.ɵɵdirectiveInject(i2.ValidationService), i0.ɵɵdirectiveInject(i3.AppRepoHelperService), i0.ɵɵdirectiveInject(i4.ElginStartUpService));\n  };\n\n  PermitMapDesignationTabComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: PermitMapDesignationTabComponent,\n    selectors: [[\"app-permit-map-designation-tab\"]],\n    inputs: {\n      dataModel: \"dataModel\",\n      configModel: \"configModel\"\n    },\n    features: [i0.ɵɵInheritDefinitionFeature],\n    ngContentSelectors: _c1,\n    decls: 34,\n    vars: 5,\n    consts: [[1, \"container-fluid\"], [1, \"row\", \"permit-details\"], [1, \"col-md-8\"], [1, \"map-container\"], [1, \"col-md-4\"], [1, \"special-designation-container2\"], [\"fxLayout\", \"row\", \"fxLayoutGap\", \"20px\", \"fxLayoutAlign\", \"space-between start\", 1, \"detail-container\"], [\"fxFlex\", \"50\", 1, \"info-element\"], [\"for\", \"\"], [\"fxFlex\", \"100\", 1, \"info-element\"], [4, \"ngIf\"], [1, \"special-designation-container\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"space-between center\"], [1, \"designationFont\"], [1, \"designations-list\"], [1, \"list-group\"], [\"class\", \"list-group-item list-item-background\", 4, \"ngFor\", \"ngForOf\"], [1, \"list-group-item\", \"list-item-background\"], [\"fxLayout\", \"row\", \"fxLayoutAlign\", \"start start\", \"fxLayoutGap\", \"20px\"], [3, \"checked\", \"change\"], [1, \"code\"], [1, \"description\"], [1, \"periodicity\"]],\n    template: function PermitMapDesignationTabComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵprojectionDef(_c0);\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"div\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵprojection(4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(5, \"div\", 4);\n        i0.ɵɵelementStart(6, \"div\", 5);\n        i0.ɵɵelementStart(7, \"div\");\n        i0.ɵɵelementStart(8, \"div\", 6);\n        i0.ɵɵelementStart(9, \"div\", 7);\n        i0.ɵɵelementStart(10, \"label\", 8);\n        i0.ɵɵtext(11, \"Post Code\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"p\");\n        i0.ɵɵtext(13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"div\", 7);\n        i0.ɵɵelementStart(15, \"label\", 8);\n        i0.ɵɵtext(16, \"USRN\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(17, \"p\");\n        i0.ɵɵtext(18);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(19, \"hr\");\n        i0.ɵɵelementStart(20, \"div\", 6);\n        i0.ɵɵelementStart(21, \"div\", 9);\n        i0.ɵɵelementStart(22, \"label\", 8);\n        i0.ɵɵtext(23, \"Works Location Description\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"p\");\n        i0.ɵɵtext(25);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(26, \"hr\");\n        i0.ɵɵelementStart(27, \"div\", 6);\n        i0.ɵɵelementStart(28, \"div\", 9);\n        i0.ɵɵelementStart(29, \"label\", 8);\n        i0.ɵɵtext(30, \"Location details\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(31, \"p\");\n        i0.ɵɵtext(32);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(33, PermitMapDesignationTabComponent_div_33_Template, 9, 1, \"div\", 10);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(13);\n        i0.ɵɵtextInterpolate(ctx.permitFormData[0].postcode);\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate(ctx.permitFormData[0].usrn);\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.permitFormData[0].work_description);\n        i0.ɵɵadvance(7);\n        i0.ɵɵtextInterpolate(ctx.permitFormData[0].location_details);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !(ctx.dataModel.data.special_designations.length < 1));\n      }\n    },\n    directives: [i5.DefaultLayoutDirective, i5.DefaultLayoutGapDirective, i5.DefaultLayoutAlignDirective, i5.DefaultFlexDirective, i6.NgIf, i6.NgForOf, i7.MatCard, i8.MatCheckbox],\n    styles: [\".map-container[_ngcontent-%COMP%]{background:#ffffff 0% 0% no-repeat padding-box;box-shadow:0 3px 4px #c1cbff3b;border-radius:4px;padding:15px;margin-top:15px}.special-designation-container[_ngcontent-%COMP%]{background:#ffffff 0% 0% no-repeat padding-box;box-shadow:0 3px 4px #c1cbff3b;border-radius:4px;margin-top:15px;margin-bottom:15px;height:298px;max-height:298px;padding:15px}.list-item-background[_ngcontent-%COMP%]{background-color:#e6e6e6;padding:3px!important}.code[_ngcontent-%COMP%]{font-weight:bold}.description[_ngcontent-%COMP%]{color:var(--text-highlighted-1)}.periodicity[_ngcontent-%COMP%]{color:var(--text-highlighted-2)}.designations-list[_ngcontent-%COMP%]{max-height:255px;overflow-y:auto;padding:5px 0}.designationFont[_ngcontent-%COMP%]{font-weight:bold;color:var(--theme-color)}.special-designation-container2[_ngcontent-%COMP%]{background:#ffffff 0% 0% no-repeat padding-box;box-shadow:0 3px 4px #c1cbff3b;border-radius:4px;padding:15px;margin-top:15px}.permit-details[_ngcontent-%COMP%]{margin-bottom:30px}\"]\n  });\n  return PermitMapDesignationTabComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}